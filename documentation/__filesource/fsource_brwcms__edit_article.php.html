<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos  -->
			<title>File Source for edit_article.php</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
											</head>
		<body>
						<h1>Source for file edit_article.php</h1>
<p>Documentation is available at <a href="../brwcms/_code_edit_article_php.html">edit_article.php</a></p>
<div class="src-code">
<pre><ol><li><a name="a1"></a><span class="src-php">&lt;?php</span></li>
<li><a name="a2"></a><span class="src-inc">include</span><span class="src-sym">( </span><span class="src-str">'configuration.php' </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a3"></a>require <span class="src-sym">( </span><span class="src-str">'../admin/coreclass.php' </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a4"></a><a href="http://www.php.net/session_start">session_start</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a5"></a><span class="src-comm">// if user is not login..redirect him to login page </span></li>
<li><a name="a6"></a><span class="src-key">if </span><span class="src-sym">( </span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'login'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{ </span></li>
<li><a name="a7"></a>    <a href="http://www.php.net/header">header</a><span class="src-sym">(</span><span class="src-str">'Location: ../admin/login.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a8"></a><span class="src-sym">}</span></li>
<li><a name="a9"></a><span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'login'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a10"></a>    <span class="src-var">$userID </span>= <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'userID'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a11"></a>    <span class="src-var">$usertype </span>= <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'usertype'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a12"></a>    <span class="src-comm">// Log the activity</span></li>
<li><a name="a13"></a>        <span class="src-var">$action </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/activity.html">activity</a></span><span class="src-sym">;</span></li>
<li><a name="a14"></a>    <span class="src-var">$action</span><span class="src-sym">-&gt;</span><span class="src-id">track_activity</span><span class="src-sym">( </span><span class="src-var">$userID</span><span class="src-sym">, </span><span class="src-var">$action</span><span class="src-sym">-&gt;</span><span class="src-id">editing_article</span><span class="src-sym">, </span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'title'</span><span class="src-sym">] </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a15"></a><span class="src-sym">}</span></li>
<li><a name="a16"></a><span class="src-comm">// print_r($_SESSION);</span></li>
<li><a name="a17"></a><span class="src-comm">// print_r($_SESSION['article_imgs']);</span></li>
<li><a name="a18"></a>unset<span class="src-sym">(</span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'article_imgs'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a19"></a><span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a20"></a>&nbsp;</li>
<li><a name="a21"></a>&nbsp;</li>
<li><a name="a22"></a>&nbsp;</li>
<li><a name="a23"></a><span class="src-comm">// get the checked item of the article..</span></li>
<li><a name="a24"></a><span class="src-key">if </span><span class="src-sym">( </span>isset <span class="src-sym">( </span><span class="src-var">$_POST</span><span class="src-sym">[</span><span class="src-str">'checkitem'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">] </span><span class="src-sym">) </span>&amp;&amp; <span class="src-var">$_POST</span><span class="src-sym">[</span><span class="src-str">'checkitem'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">] </span>!= <span class="src-str">'' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a25"></a>    <span class="src-var">$articleID </span>= <span class="src-var">$_POST</span><span class="src-sym">[</span><span class="src-str">'checkitem'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a26"></a>    <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'articleID'</span><span class="src-sym">] </span>= <span class="src-var">$articleID</span><span class="src-sym">;</span></li>
<li><a name="a27"></a><span class="src-sym">}</span></li>
<li><a name="a28"></a><span class="src-key">switch </span><span class="src-sym">( </span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'stageID'</span><span class="src-sym">] </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a29"></a>    <span class="src-key">case </span><span class="src-num">1</span>:</li>
<li><a name="a30"></a>        <span class="src-var">$set_template </span>= <span class="src-str">&quot;../templates/edit_article2.tpl.php&quot;</span><span class="src-sym">;                                    </span></li>
<li><a name="a31"></a>        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a32"></a>    <span class="src-key">case </span><span class="src-num">2</span>: <span class="src-comm">// editing </span></li>
<li><a name="a33"></a>                <span class="src-var">$set_template </span>= <span class="src-str">&quot;../templates/edit_article_editor2.tpl.php&quot;</span><span class="src-sym">;                                </span></li>
<li><a name="a34"></a>        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a35"></a>    <span class="src-key">case </span><span class="src-num">3</span>: <span class="src-comm">// proofreading</span></li>
<li><a name="a36"></a>                <span class="src-var">$set_template </span>= <span class="src-str">&quot;../templates/edit_article_editor2.tpl.php&quot;</span><span class="src-sym">;                                </span></li>
<li><a name="a37"></a>        <span class="src-key">break</span><span class="src-sym">;        </span></li>
<li><a name="a38"></a>    <span class="src-key">case </span><span class="src-num">4</span>: <span class="src-comm">// publishing</span></li>
<li><a name="a39"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$set_template </span>!= <span class="src-str">''</span><span class="src-sym">)) </span><span class="src-var">$set_template </span>= <span class="src-str">&quot;../templates/edit_article.tpl.php&quot;</span><span class="src-sym">;                            </span></li>
<li><a name="a40"></a>        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a41"></a><span class="src-sym">}</span></li>
<li><a name="a42"></a>&nbsp;</li>
<li><a name="a43"></a><span class="src-var">$n </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">getnumrows</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a44"></a><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">freeresult</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a45"></a>&nbsp;</li>
<li><a name="a46"></a><span class="src-doc">/**</span></li>
<li><a name="a47"></a><span class="src-doc"> * Get all the tasks</span></li>
<li><a name="a48"></a><span class="src-doc"> */</span></li>
<li><a name="a49"></a><span class="src-var">$sql </span>= <span class="src-str">&quot; </span><span class="src-id">select</span> * <span class="src-id">from tasks where assignedto</span> =  '<span class="src-var">$userID</span>' <span class="src-id">and status</span> != '<span class="src-id">Completed</span>' <span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a50"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a51"></a>    <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>.<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a52"></a><span class="src-sym">}</span></li>
<li><a name="a53"></a><span class="src-comm">//echo $sql;</span></li>
<li><a name="a54"></a><span class="src-var">$tasks </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a55"></a><span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$row </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) ) </span><span class="src-sym">{</span></li>
<li><a name="a56"></a>    <span class="src-var">$tasks</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">; </span></li>
<li><a name="a57"></a><span class="src-sym">}</span></li>
<li><a name="a58"></a><span class="src-var">$sql </span>= <span class="src-str">&quot;select * from article_tasks where articleID = &quot;  </span>. <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'articleID'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a59"></a><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a60"></a><span class="src-var">$currenttask</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a61"></a><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">freeresult</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a62"></a><span class="src-var">$tasklist </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a63"></a><span class="src-key">foreach</span><span class="src-sym">( </span><span class="src-var">$tasks </span><span class="src-key">as </span><span class="src-var">$field </span>=&gt; <span class="src-var">$data </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a64"></a>    <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">taskID </span>== <span class="src-var">$currenttask</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">taskID </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a65"></a>        <span class="src-var">$tasklist </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">taskID </span>. <span class="src-str">'&quot; selected &gt;'</span><span class="src-sym">;</span></li>
<li><a name="a66"></a>        <span class="src-var">$tasklist </span>.= <span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">subject</span><span class="src-sym">;</span></li>
<li><a name="a67"></a>        <span class="src-var">$tasklist </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a68"></a>    <span class="src-sym">}</span></li>
<li><a name="a69"></a>    <span class="src-key">else</span><span class="src-sym">{</span></li>
<li><a name="a70"></a>        <span class="src-var">$tasklist </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">taskID </span>. <span class="src-str">'&quot;&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a71"></a>        <span class="src-var">$tasklist </span>.= <span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">subject</span><span class="src-sym">;</span></li>
<li><a name="a72"></a>        <span class="src-var">$tasklist </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a73"></a>    <span class="src-sym">}</span></li>
<li><a name="a74"></a><span class="src-sym">}</span></li>
<li><a name="a75"></a>&nbsp;</li>
<li><a name="a76"></a><span class="src-comm">// Get all the news category</span></li>
<li><a name="a77"></a><span class="src-var">$sql </span>= <span class="src-str">&quot; select * from category &quot;</span><span class="src-sym">;</span></li>
<li><a name="a78"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a79"></a>    <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>.<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a80"></a><span class="src-sym">}</span></li>
<li><a name="a81"></a><span class="src-comm">// Populate all the news-category into an array..</span></li>
<li><a name="a82"></a><span class="src-var">$category </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a83"></a><span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$row </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) ) </span><span class="src-sym">{</span></li>
<li><a name="a84"></a>    <span class="src-var">$category</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">; </span></li>
<li><a name="a85"></a><span class="src-sym">}</span></li>
<li><a name="a86"></a><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">freeresult</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a87"></a>&nbsp;</li>
<li><a name="a88"></a><span class="src-comm">// Get the current category of the article..</span></li>
<li><a name="a89"></a><span class="src-var">$current_category_name </span>= <a href="../brwcms/_code_corefunctions_php.html#functiongetCategory_name">getCategory_name</a><span class="src-sym">( </span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'articleID'</span><span class="src-sym">] </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a90"></a><span class="src-var">$category_names </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a91"></a><span class="src-key">foreach</span><span class="src-sym">( </span><span class="src-var">$category </span><span class="src-key">as </span><span class="src-var">$field </span>=&gt; <span class="src-var">$data </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a92"></a>    <span class="src-comm">// set the default category of the article..</span></li>
<li><a name="a93"></a>        <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">category_name </span>== <span class="src-var">$current_category_name </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a94"></a>        <span class="src-var">$category_names </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">categoryID </span>. <span class="src-str">'&quot; selected&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a95"></a>        <span class="src-var">$category_names </span>.= <span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">category_name</span><span class="src-sym">;</span></li>
<li><a name="a96"></a>        <span class="src-var">$category_names </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a97"></a>    <span class="src-sym">}</span></li>
<li><a name="a98"></a>    <span class="src-key">else</span><span class="src-sym">{ </span><span class="src-comm">// loop other categorys</span></li>
<li><a name="a99"></a>                <span class="src-var">$category_names </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">categoryID </span>. <span class="src-str">'&quot;&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a100"></a>        <span class="src-var">$category_names </span>.= <span class="src-var">$data</span><span class="src-sym">-&gt;</span><span class="src-id">category_name</span><span class="src-sym">;</span></li>
<li><a name="a101"></a>        <span class="src-var">$category_names </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a102"></a>    <span class="src-sym">}    </span></li>
<li><a name="a103"></a><span class="src-sym">}</span></li>
<li><a name="a104"></a><span class="src-comm">// Return the allowable stages to be set given the stageID of the article..</span></li>
<li><a name="a105"></a><span class="src-comm">// howevr, this part of code is already useless,,ive changed it to more flexible style.</span></li>
<li><a name="a106"></a><span class="src-comm">// so no more dropdown of stages will happen.</span></li>
<li><a name="a107"></a><span class="src-var">$allow_stage_to_set </span>= <span class="src-id">allow_Stage_to_Set </span><span class="src-sym">( </span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'stageID'</span><span class="src-sym">] </span><span class="src-sym">) </span><span class="src-sym">;</span></li>
<li><a name="a108"></a><span class="src-var">$sql </span>= <span class="src-str">&quot; select * from stages s &quot;</span><span class="src-sym">;</span></li>
<li><a name="a109"></a><span class="src-var">$sql </span>.= <span class="src-str">&quot; where s.stageID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'stageID'</span><span class="src-sym">] </span><span class="src-sym">) </span><span class="src-sym">;</span></li>
<li><a name="a110"></a><span class="src-var">$sql </span>.= <span class="src-str">&quot; or s.stageID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$allow_stage_to_set </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a111"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a112"></a>    <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>.<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a113"></a><span class="src-sym">}</span></li>
<li><a name="a114"></a>&nbsp;</li>
<li><a name="a115"></a><span class="src-var">$allow_stage </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a116"></a><span class="src-var">$stage </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a117"></a><span class="src-key">while </span><span class="src-sym">( </span><span class="src-var">$allow_stage</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a118"></a><span class="src-key">for </span><span class="src-sym">( </span><span class="src-var">$i </span>= <span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$allow_stage</span><span class="src-sym">)</span>-<span class="src-num">1</span><span class="src-sym">; </span><span class="src-var">$i</span>++ <span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a119"></a>    <span class="src-key">foreach</span><span class="src-sym">( </span><span class="src-var">$allow_stage </span><span class="src-key">as </span><span class="src-var">$field </span>=&gt; <span class="src-var">$value </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a120"></a>        <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$field </span>== <span class="src-str">'stageID' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a121"></a>            <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">stageID </span>== <span class="src-var">$edit_articles</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">stageID </span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">// Get the stageID of the article..</span></li>
<li><a name="a122"></a>                                <span class="src-var">$stage </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$allow_stage</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">stageID </span>. <span class="src-str">'&quot; selected &gt;'</span><span class="src-sym">;        </span></li>
<li><a name="a123"></a>                <span class="src-var">$stage </span>.= <span class="src-var">$allow_stage</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">stage </span><span class="src-sym">;</span></li>
<li><a name="a124"></a>                <span class="src-var">$stage </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a125"></a>            <span class="src-sym">}</span></li>
<li><a name="a126"></a>            <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a127"></a>                <span class="src-var">$stage </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$allow_stage</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">stageID </span>. <span class="src-str">'&quot;  &gt;'</span><span class="src-sym">;        </span></li>
<li><a name="a128"></a>                <span class="src-var">$stage </span>.= <span class="src-var">$allow_stage</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">stage </span><span class="src-sym">;</span></li>
<li><a name="a129"></a>                <span class="src-var">$stage </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a130"></a>            <span class="src-sym">}</span></li>
<li><a name="a131"></a>        <span class="src-sym">}</span></li>
<li><a name="a132"></a>    <span class="src-sym">}</span></li>
<li><a name="a133"></a><span class="src-sym">}</span></li>
<li><a name="a134"></a><span class="src-doc">/**</span></li>
<li><a name="a135"></a><span class="src-doc"> * Get the image sets of the article</span></li>
<li><a name="a136"></a><span class="src-doc"> */</span></li>
<li><a name="a137"></a><span class="src-var">$sql </span>= <span class="src-str">&quot; select * from stockphotos s, &quot;</span><span class="src-sym">;</span></li>
<li><a name="a138"></a><span class="src-var">$sql </span>.= <span class="src-str">&quot; article_imgs ai &quot;</span><span class="src-sym">;</span></li>
<li><a name="a139"></a><span class="src-var">$sql </span>.= <span class="src-str">&quot; where ai.articleID=&quot; </span>. <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'articleID'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a140"></a><span class="src-var">$sql </span>.= <span class="src-str">&quot; and ai.imageID = s.imageID &quot;</span><span class="src-sym">;</span></li>
<li><a name="a141"></a><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a142"></a><span class="src-var">$article_images </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a143"></a><span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a144"></a><span class="src-comm">//print_r($article_images); </span></li>
<li><a name="a145"></a><span class="src-var">$thumbnail </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a146"></a><span class="src-key">for</span><span class="src-sym">( </span><span class="src-var">$i </span>= <span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i</span>&lt; <a href="http://www.php.net/count">count</a><span class="src-sym">( </span><span class="src-var">$article_images </span><span class="src-sym">)</span>-<span class="src-num">1</span><span class="src-sym">; </span><span class="src-var">$i</span>++ <span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a147"></a>    <span class="src-key">foreach</span><span class="src-sym">( </span><span class="src-var">$article_images </span><span class="src-key">as </span><span class="src-var">$field </span>=&gt; <span class="src-var">$value </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a148"></a>        <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$field </span>== <span class="src-str">'imageID' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a149"></a>            <span class="src-var">$x </span>= <a href="../brwcms/_code_corefunctions_php.html#functionmakeRelativePath">makeRelativePath</a><span class="src-sym">(</span><span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">image_filename</span><span class="src-sym">, </span><span class="src-num">4</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a150"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;div class=&quot;xpthumbnail&quot;&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a151"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;img src=&quot;' </span>. <span class="src-var">$x </span>. <span class="src-str">'&quot; name=&quot;Image1&quot; class=&quot;&quot; width=&quot;200&quot;  height=&quot;100&quot; border=&quot;0&quot; &gt;'</span><span class="src-sym">;        </span></li>
<li><a name="a152"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;p&gt;&lt;b&gt;Photo by:&lt;/b&gt;' </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">image_photographer_author </span>. <span class="src-str">'&lt;/p&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a153"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;p&gt;&lt;b&gt;Caption:&lt;/b&gt;' </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">image_captions </span>. <span class="src-str">'&lt;/p&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a154"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;p&gt;&lt;b&gt;Alt:&lt;/b&gt;' </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">image_alttext </span>. <span class="src-str">'&lt;/p&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a155"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;div align=&quot;center&quot;&gt;&amp;nbsp;'</span><span class="src-sym">;    </span></li>
<li><a name="a156"></a>            </li>
<li><a name="a157"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;a href=&quot;#&quot; onClick=popupWindow(&quot;' </span>. <span class="src-str">&quot;../admin/popups/edit_imageinfo.php?imgID=&quot; </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">imageID </span>. <span class="src-str">'&quot;,&quot;win1&quot;,350,450,&quot;no&quot;,&quot;yes&quot;);&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a158"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;b&gt;Image Details&lt;/b&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a159"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;/a&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a160"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;'</span><span class="src-sym">;</span></li>
<li><a name="a161"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;a href=&quot;#&quot;  onClick=popupWindow(&quot;' </span>. <span class="src-str">&quot;</span><span class="src-var">$x</span><span class="src-str">&quot; </span>. <span class="src-str">'&quot;,' </span>. <span class="src-str">&quot;</span><span class="src-var">$i</span><span class="src-str">&quot; </span>. <span class="src-str">',350,350,&quot;yes&quot;,&quot;yes&quot;);&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a162"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;b&gt;Preview Image&lt;/b&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a163"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;/a&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a164"></a>            </li>
<li><a name="a165"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;/div&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a166"></a>            <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;/div&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a167"></a>        <span class="src-sym">}</span></li>
<li><a name="a168"></a>    <span class="src-sym">}</span></li>
<li><a name="a169"></a><span class="src-sym">}</span></li>
<li><a name="a170"></a>&nbsp;</li>
<li><a name="a171"></a><span class="src-comm">// Populate frontpage sections</span></li>
<li><a name="a172"></a><span class="src-var">$sql </span>= <span class="src-str">&quot; select * from frontpage_sections &quot;</span><span class="src-sym">;</span></li>
<li><a name="a173"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a174"></a>    <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>.<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a175"></a><span class="src-sym">}</span></li>
<li><a name="a176"></a><span class="src-var">$frontpage </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a177"></a><span class="src-key">while </span><span class="src-sym">( </span><span class="src-var">$row </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-var">$frontpage</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">;</span></li>
<li><a name="a178"></a>&nbsp;</li>
<li><a name="a179"></a><span class="src-var">$sql </span>= <span class="src-str">&quot;</span><span class="src-id">select</span> * <span class="src-id">from user_stage us</span>,</li>
<li><a name="a180"></a>        <span class="src-id">stages s</span></li>
<li><a name="a181"></a>        <span class="src-id">where us</span>.<span class="src-id">userID</span> = <span class="src-var">$userID</span></li>
<li><a name="a182"></a>        <span class="src-id">and    s</span>.<span class="src-id">stageID</span> = <span class="src-id">us</span>.<span class="src-id">stageID </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a183"></a><span class="src-comm">// print $sql;        </span></li>
<li><a name="a184"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)))</span><span class="src-sym">{</span></li>
<li><a name="a185"></a>    <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a186"></a><span class="src-sym">}</span></li>
<li><a name="a187"></a><span class="src-var">$user_stage </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a188"></a><span class="src-key">while </span><span class="src-sym">( </span><span class="src-var">$row </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) ) </span><span class="src-sym">{</span></li>
<li><a name="a189"></a>    <span class="src-var">$user_stage</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">;</span></li>
<li><a name="a190"></a><span class="src-sym">}</span></li>
<li><a name="a191"></a><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">freeresult</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a192"></a><span class="src-comm">// continue here..my bitok is hungry :( kalooy sad...</span></li>
<li><a name="a193"></a><span class="src-comm">// the user has the right to put the article on frontpage regardless of the position..</span></li>
<li><a name="a194"></a><span class="src-key">foreach</span><span class="src-sym">( </span><span class="src-var">$user_stage </span><span class="src-key">as </span><span class="src-var">$key </span>=&gt; <span class="src-var">$stage </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a195"></a>    <span class="src-key">if </span><span class="src-sym">(( </span><span class="src-var">$stage</span><span class="src-sym">-&gt;</span><span class="src-id">stageID </span>== <span class="src-num">3 </span><span class="src-sym">) </span>|| <span class="src-sym">( </span><span class="src-var">$stage</span><span class="src-sym">-&gt;</span><span class="src-id">stageID </span>== <span class="src-num">2 </span><span class="src-sym">))</span><span class="src-sym">{</span></li>
<li><a name="a196"></a>        <span class="src-var">$xxx </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a197"></a>        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a198"></a>    <span class="src-sym">}    </span></li>
<li><a name="a199"></a><span class="src-sym">}</span></li>
<li><a name="a200"></a><span class="src-comm">//if ( strcasecmp( $usertype, 'news editor' ) == 0 ) {</span></li>
<li><a name="a201"></a><span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$xxx </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a202"></a>    <span class="src-comm">// Lets dtermine where the article is part on the frontpage</span></li>
<li><a name="a203"></a>        <span class="src-var">$current_frontpage_type </span>= <a href="../brwcms/_code_corefunctions_php.html#functiongetFrontpage_type">getFrontpage_type</a><span class="src-sym">( </span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'articleID'</span><span class="src-sym">] </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a204"></a>    <span class="src-comm">//echo $current_frontpage_type;</span></li>
<li><a name="a205"></a>    <span class="src-comm">// populate the frontpage tpye</span></li>
<li><a name="a206"></a>                <span class="src-key">foreach</span><span class="src-sym">( </span><span class="src-var">$frontpage </span><span class="src-key">as </span><span class="src-var">$field </span>=&gt; <span class="src-var">$value </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a207"></a>            <span class="src-comm">// select dah current frontpage type if it exists..</span></li>
<li><a name="a208"></a>                                <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_section </span>== <span class="src-var">$current_frontpage_type </span><span class="src-sym">) </span><span class="src-sym">{ </span></li>
<li><a name="a209"></a>                    <span class="src-var">$optfrontpage </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_sectionID </span>. <span class="src-str">'&quot; selected &gt;'</span><span class="src-sym">;        </span></li>
<li><a name="a210"></a>                    <span class="src-var">$optfrontpage </span>.= <span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_section </span><span class="src-sym">;</span></li>
<li><a name="a211"></a>                    <span class="src-var">$optfrontpage </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a212"></a>                <span class="src-sym">}</span></li>
<li><a name="a213"></a>                <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a214"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_section </span>== <span class="src-str">'Regular News' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a215"></a>                        <span class="src-var">$optfrontpage </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_sectionID </span>. <span class="src-str">'&quot; selected &gt;'</span><span class="src-sym">;        </span></li>
<li><a name="a216"></a>                        <span class="src-var">$optfrontpage </span>.= <span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_section</span><span class="src-sym">;</span></li>
<li><a name="a217"></a>                        <span class="src-var">$optfrontpage </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a218"></a>                    <span class="src-sym">}</span><span class="src-key">else</span><span class="src-sym">{</span></li>
<li><a name="a219"></a>                        <span class="src-var">$optfrontpage </span>.= <span class="src-str">'&lt;option value=&quot;' </span>. <span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_sectionID </span>. <span class="src-str">'&quot;  &gt;'</span><span class="src-sym">;        </span></li>
<li><a name="a220"></a>                        <span class="src-var">$optfrontpage </span>.= <span class="src-var">$value</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_section</span><span class="src-sym">;</span></li>
<li><a name="a221"></a>                        <span class="src-var">$optfrontpage </span>.= <span class="src-str">'&lt;/option&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a222"></a>                    <span class="src-sym">}</span></li>
<li><a name="a223"></a>                <span class="src-sym">}</span></li>
<li><a name="a224"></a>            <span class="src-sym">}</span></li>
<li><a name="a225"></a>    </li>
<li><a name="a226"></a>    <span class="src-var">$thumbnail </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a227"></a>    <span class="src-key">for</span><span class="src-sym">( </span><span class="src-var">$i </span>= <span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i</span>&lt; <a href="http://www.php.net/count">count</a><span class="src-sym">( </span><span class="src-var">$article_images </span><span class="src-sym">)</span>-<span class="src-num">1</span><span class="src-sym">; </span><span class="src-var">$i</span>++ <span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a228"></a>        <span class="src-key">foreach</span><span class="src-sym">( </span><span class="src-var">$article_images </span><span class="src-key">as </span><span class="src-var">$field </span>=&gt; <span class="src-var">$value </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a229"></a>            <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$field </span>== <span class="src-str">'imageID' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a230"></a>                <span class="src-var">$x </span>= <a href="../brwcms/_code_corefunctions_php.html#functionmakeRelativePath">makeRelativePath</a><span class="src-sym">(</span><span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">image_filename</span><span class="src-sym">, </span><span class="src-num">4</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a231"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;div class=&quot;xpthumbnail&quot;&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a232"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;img src=&quot;' </span>. <span class="src-var">$x </span>. <span class="src-str">'&quot; name=&quot;Image1&quot; class=&quot;&quot; width=&quot;200&quot;  height=&quot;100&quot; border=&quot;0&quot; &gt;'</span><span class="src-sym">;        </span></li>
<li><a name="a233"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;p&gt;&lt;b&gt;Photo by:&lt;/b&gt;' </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">image_photographer_author </span>. <span class="src-str">'&lt;/p&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a234"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;p&gt;&lt;b&gt;Caption:&lt;/b&gt;' </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">image_captions </span>. <span class="src-str">'&lt;/p&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a235"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;p&gt;&lt;b&gt;Alt:&lt;/b&gt;' </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">image_alttext </span>. <span class="src-str">'&lt;/p&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a236"></a>                <span class="src-key">if</span><span class="src-sym">( </span><span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">show_image </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a237"></a>                    <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;pre class=&quot;orange&quot;&gt;&lt;b&gt;Select image:&lt;/b&gt;&lt;input name=&quot;imageID[]' </span>.  <span class="src-str">'&quot; type=&quot;checkbox&quot; class=&quot;bigbox&quot; value=&quot;' </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">imageID </span>. <span class="src-str">'&quot; checked &gt;&lt;/pre&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a238"></a>                <span class="src-sym">}</span></li>
<li><a name="a239"></a>                <span class="src-key">else</span><span class="src-sym">{</span></li>
<li><a name="a240"></a>                    <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;pre class=&quot;orange&quot;&gt;&lt;b&gt;Select image:&lt;/b&gt;&lt;input name=&quot;imageID[]' </span>.  <span class="src-str">'&quot; type=&quot;checkbox&quot; class=&quot;bigbox&quot; value=&quot;' </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">imageID </span>. <span class="src-str">'&quot; &gt;&lt;/pre&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a241"></a>                <span class="src-sym">}</span></li>
<li><a name="a242"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;a href=&quot;#&quot; onClick=popupWindow(&quot;' </span>. <span class="src-str">&quot;../admin/popups/edit_imageinfo.php?imgID=&quot; </span>. <span class="src-var">$article_images</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">imageID </span>. <span class="src-str">'&quot;,&quot;win1&quot;,350,450,&quot;no&quot;,&quot;yes&quot;);&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a243"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;b&gt;Image Details&lt;/b&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a244"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;/a&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a245"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;'</span><span class="src-sym">;</span></li>
<li><a name="a246"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;a href=&quot;#&quot;  onClick=popupWindow(&quot;' </span>. <span class="src-str">&quot;</span><span class="src-var">$x</span><span class="src-str">&quot; </span>. <span class="src-str">'&quot;,' </span>. <span class="src-str">&quot;</span><span class="src-var">$i</span><span class="src-str">&quot; </span>. <span class="src-str">',350,350,&quot;yes&quot;,&quot;yes&quot;);&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a247"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;b&gt;Preview Image&lt;/b&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a248"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;/a&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a249"></a>                </li>
<li><a name="a250"></a>                <span class="src-var">$thumbnail </span>.= <span class="src-str">'&lt;/div&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a251"></a>            <span class="src-sym">}</span></li>
<li><a name="a252"></a>        <span class="src-sym">}</span></li>
<li><a name="a253"></a>    <span class="src-sym">}</span></li>
<li><a name="a254"></a><span class="src-sym">}</span></li>
<li><a name="a255"></a><span class="src-comm">//  echo $set_template;</span></li>
<li><a name="a256"></a><span class="src-comm">// Get the authors name</span></li>
<li><a name="a257"></a><span class="src-var">$author_name </span>= <a href="../brwcms/_code_corefunctions_php.html#functiongetUser_info">getUser_info</a><span class="src-sym">( </span><span class="src-var">$userID </span><span class="src-sym">, </span><span class="src-str">'fullname' </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a258"></a><span class="src-var">$keywords </span>= <a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_keywords">getArticle_keywords</a><span class="src-sym">( </span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'articleID'</span><span class="src-sym">] </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a259"></a><span class="src-comm">// Get the article body of this article..</span></li>
<li><a name="a260"></a><span class="src-comm">// print_r($_SESSION);</span></li>
<li><a name="a261"></a><span class="src-var">$article_body </span>= <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'article_body'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a262"></a><span class="src-var">$article_title </span>= <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'title'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a263"></a><span class="src-comm">// echo $article_body;</span></li>
<li><a name="a264"></a><span class="src-var">$created </span>= <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'created'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a265"></a><span class="src-comm">// ok baby, lets start compiling the page now..go! go! go! {mh}</span></li>
<li><a name="a266"></a><span class="src-var">$tpl </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/template_parser.html">template_parser</a></span><span class="src-sym">( </span><span class="src-var">$set_template </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a267"></a><span class="src-var">$tags </span>= <span class="src-key">array</span><span class="src-sym">(</span></li>
<li><a name="a268"></a>        <span class="src-str">'{STAGE}'             </span>=&gt; <span class="src-var">$stage</span><span class="src-sym">,</span></li>
<li><a name="a269"></a>        <span class="src-str">'{ARTICLE_TITLE}'     </span>=&gt; <span class="src-var">$article_title</span><span class="src-sym">,</span></li>
<li><a name="a270"></a>        <span class="src-str">'{DATE_CREATED}'    </span>=&gt; <span class="src-id">friendlydate</span><span class="src-sym">(</span><span class="src-var">$created</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a271"></a>        <span class="src-str">'{CATEGORY_NAMES}'     </span>=&gt; <span class="src-var">$category_names</span><span class="src-sym">,</span></li>
<li><a name="a272"></a>        <span class="src-str">'{TASKS}'            </span>=&gt; <span class="src-var">$tasklist</span><span class="src-sym">,                            </span></li>
<li><a name="a273"></a>        <span class="src-str">'{KEYWORDS}'         </span>=&gt; <span class="src-var">$keywords</span><span class="src-sym">,        </span></li>
<li><a name="a274"></a>        <span class="src-str">'{AUTHOR}'             </span>=&gt; <span class="src-var">$author_name</span><span class="src-sym">,</span></li>
<li><a name="a275"></a>        <span class="src-str">'{THUMBNAIL}'        </span>=&gt; <span class="src-var">$thumbnail</span><span class="src-sym">,</span></li>
<li><a name="a276"></a>        <span class="src-str">'{MESSAGE}'            </span>=&gt; <span class="src-var">$message</span><span class="src-sym">,</span></li>
<li><a name="a277"></a>        <span class="src-str">'{BODY}'             </span>=&gt; <span class="src-var">$article_body </span><span class="src-sym">, </span></li>
<li><a name="a278"></a>        <span class="src-str">'{FRONTPAGE}'        </span>=&gt; <span class="src-var">$optfrontpage</span><span class="src-sym">,    </span></li>
<li><a name="a279"></a>        <span class="src-str">'{SITENAME}'         </span>=&gt; <span class="src-str">'CMS Adminss'</span><span class="src-sym">,</span></li>
<li><a name="a280"></a>        <span class="src-str">'{HEADER}'             </span>=&gt; <span class="src-str">' '</span><span class="src-sym">,</span></li>
<li><a name="a281"></a>        <span class="src-str">'{TOPNAV}'             </span>=&gt; <span class="src-str">'../admin/top_menu.php'</span><span class="src-sym">,</span></li>
<li><a name="a282"></a>        <span class="src-str">'{FOOTER}'             </span>=&gt;  <span class="src-str">'footer.php' </span></li>
<li><a name="a283"></a>    <span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a284"></a><span class="src-var">$tpl</span><span class="src-sym">-&gt;</span><span class="src-id">parse_template</span><span class="src-sym">( </span><span class="src-var">$tags </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a285"></a>print <span class="src-var">$tpl</span><span class="src-sym">-&gt;</span><span class="src-id">display</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a286"></a>&nbsp;</li>
<li><a name="a287"></a><span class="src-php">?&gt;</span></li>
</ol></pre>
</div>
	<p class="notes" id="credit">
		Documentation generated on Wed,  5 Apr 2006 20:09:25 -0700 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.3.0RC4</a>
	</p>
	</body>
</html>