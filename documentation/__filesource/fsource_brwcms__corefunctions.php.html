<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos  -->
			<title>File Source for corefunctions.php</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
											</head>
		<body>
						<h1>Source for file corefunctions.php</h1>
<p>Documentation is available at <a href="../brwcms/_code_corefunctions_php.html">corefunctions.php</a></p>
<div class="src-code">
<pre><ol><li><a name="a1"></a><span class="src-php">&lt;?php</span></li>
<li><a name="a2"></a><span class="src-comm">/*</span></li>
<li><a name="a3"></a><span class="src-comm"> * @name          : corefunctions.php</span></li>
<li><a name="a4"></a><span class="src-comm"> * @purpose     : Lots of functions that makes my life easier...</span></li>
<li><a name="a5"></a><span class="src-comm"> * @author         : mh</span></li>
<li><a name="a6"></a><span class="src-comm"> */</span></li>
<li><a name="a7"></a> </li>
<li><a name="a8"></a><span class="src-comm">/* Return the category name of the articleID</span></li>
<li><a name="a9"></a><span class="src-comm"> * @param int articleID</span></li>
<li><a name="a10"></a><span class="src-comm"> */</span></li>
<li><a name="a11"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetCategory_name">getCategory_name</a><span class="src-sym">( </span><span class="src-var">$articleID </span>= <span class="src-num">0 </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a12"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select category_name from category c, article_category ac &quot;</span><span class="src-sym">;</span></li>
<li><a name="a13"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where ac.articleID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">(</span><span class="src-var">$articleID</span><span class="src-sym">) </span><span class="src-sym">;</span></li>
<li><a name="a14"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and ac.categoryID = c.categoryID &quot;</span><span class="src-sym">;</span></li>
<li><a name="a15"></a>    </li>
<li><a name="a16"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a17"></a>&nbsp;</li>
<li><a name="a18"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a19"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a20"></a>    <span class="src-sym">}</span></li>
<li><a name="a21"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$category_name </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a22"></a>    <span class="src-key">return </span><span class="src-var">$category_name</span><span class="src-sym">-&gt;</span><span class="src-id">category_name</span><span class="src-sym">;</span></li>
<li><a name="a23"></a><span class="src-sym">}</span></li>
<li><a name="a24"></a><span class="src-comm">/* Return the article belongs in the category</span></li>
<li><a name="a25"></a><span class="src-comm"> * @param int categoryID, </span></li>
<li><a name="a26"></a><span class="src-comm"> */</span></li>
<li><a name="a27"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_category">getArticle_category</a><span class="src-sym">( </span><span class="src-var">$categoryID </span>= <span class="src-num">0 </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a28"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_category ac &quot;</span><span class="src-sym">;</span></li>
<li><a name="a29"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where ac.categoryID =&quot;</span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$categoryID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a30"></a>    </li>
<li><a name="a31"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a32"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a33"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a34"></a>    <span class="src-sym">}</span></li>
<li><a name="a35"></a>    <span class="src-var">$article_category </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a36"></a>    <span class="src-key">while </span><span class="src-sym">( </span><span class="src-var">$row </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">{</span></li>
<li><a name="a37"></a>    <span class="src-var">$article_category</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">;</span></li>
<li><a name="a38"></a>    <span class="src-sym">}</span></li>
<li><a name="a39"></a>    <span class="src-key">return </span><span class="src-var">$article_category</span><span class="src-sym">;</span></li>
<li><a name="a40"></a><span class="src-sym">}</span></li>
<li><a name="a41"></a>&nbsp;</li>
<li><a name="a42"></a><span class="src-comm">/* Return the category assigned for the editor</span></li>
<li><a name="a43"></a><span class="src-comm"> * @param int userID, </span></li>
<li><a name="a44"></a><span class="src-comm"> */</span></li>
<li><a name="a45"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetUser_assigned_category">getUser_assigned_category</a><span class="src-sym">( </span><span class="src-var">$userID </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a46"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from content_editor ce &quot;</span><span class="src-sym">;</span></li>
<li><a name="a47"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">where</span> <span class="src-id">ce</span>.<span class="src-id">userID</span>= '<span class="src-var">$userID</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a48"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a49"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a50"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a51"></a>    <span class="src-sym">}</span></li>
<li><a name="a52"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$assigned_category </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a53"></a>    <span class="src-key">return </span><span class="src-var">$assigned_category</span><span class="src-sym">-&gt;</span><span class="src-id">categoryID</span><span class="src-sym">;</span></li>
<li><a name="a54"></a><span class="src-sym">}</span></li>
<li><a name="a55"></a>&nbsp;</li>
<li><a name="a56"></a><span class="src-comm">/* Return the category info of the articleID</span></li>
<li><a name="a57"></a><span class="src-comm"> * @param int articleID, string info</span></li>
<li><a name="a58"></a><span class="src-comm"> */</span></li>
<li><a name="a59"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_category_info">getArticle_category_info</a><span class="src-sym">( </span><span class="src-var">$articleID </span>= <span class="src-num">0 </span><span class="src-sym">, </span><span class="src-var">$info </span>= <span class="src-str">'' </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a60"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from category c , article_category ac &quot;</span><span class="src-sym">;</span></li>
<li><a name="a61"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where c.categoryID = ac.categoryID &quot;</span><span class="src-sym">;</span></li>
<li><a name="a62"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and ac.articleID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$articleID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a63"></a>    </li>
<li><a name="a64"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a65"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a66"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a67"></a>    <span class="src-sym">}</span></li>
<li><a name="a68"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$category_name </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a69"></a>    <span class="src-key">return </span><span class="src-var">$category_name</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a70"></a><span class="src-sym">}</span></li>
<li><a name="a71"></a>&nbsp;</li>
<li><a name="a72"></a><span class="src-comm">/* Return the category info</span></li>
<li><a name="a73"></a><span class="src-comm"> * @param int categoryID, string info</span></li>
<li><a name="a74"></a><span class="src-comm"> */</span></li>
<li><a name="a75"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetCategory_info">getCategory_info</a><span class="src-sym">( </span><span class="src-var">$categoryID </span>= <span class="src-num">0 </span><span class="src-sym">, </span><span class="src-var">$info </span>= <span class="src-str">'' </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a76"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from category c &quot;</span><span class="src-sym">;</span></li>
<li><a name="a77"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where c.categoryID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$categoryID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a78"></a>    </li>
<li><a name="a79"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a80"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a81"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a82"></a>    <span class="src-sym">}</span></li>
<li><a name="a83"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$category_name </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a84"></a>    <span class="src-key">return </span><span class="src-var">$category_name</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a85"></a><span class="src-sym">}</span></li>
<li><a name="a86"></a>&nbsp;</li>
<li><a name="a87"></a><span class="src-comm">/* Return the category info</span></li>
<li><a name="a88"></a><span class="src-comm"> * @param int categoryID, string info</span></li>
<li><a name="a89"></a><span class="src-comm"> */</span></li>
<li><a name="a90"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functioncheckIfCategoryContainsArticle">checkIfCategoryContainsArticle</a><span class="src-sym">( </span><span class="src-var">$categoryID </span>= <span class="src-num">0 </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a91"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from category c &quot;</span><span class="src-sym">;</span></li>
<li><a name="a92"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where c.categoryID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$categoryID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a93"></a>    </li>
<li><a name="a94"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a95"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a96"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a97"></a>    <span class="src-sym">}</span></li>
<li><a name="a98"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$category_name </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a99"></a>    <span class="src-key">return </span><span class="src-var">$category_name</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a100"></a><span class="src-sym">}</span></li>
<li><a name="a101"></a>&nbsp;</li>
<li><a name="a102"></a><span class="src-comm">/* Return the article info</span></li>
<li><a name="a103"></a><span class="src-comm"> * @param int articleID, string info</span></li>
<li><a name="a104"></a><span class="src-comm"> */</span></li>
<li><a name="a105"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_info">getArticle_info</a> <span class="src-sym">( </span><span class="src-var">$articleID </span>= <span class="src-num">0 </span><span class="src-sym">, </span><span class="src-var">$info </span>= <span class="src-str">'' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a106"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from articles a &quot;</span><span class="src-sym">;</span></li>
<li><a name="a107"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where a.articleID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">(</span><span class="src-var">$articleID</span><span class="src-sym">)</span><span class="src-sym">; </span></li>
<li><a name="a108"></a>    </li>
<li><a name="a109"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a110"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a111"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a112"></a>    <span class="src-sym">}</span></li>
<li><a name="a113"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$article_version </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a114"></a>    <span class="src-key">return </span><span class="src-var">$article_version</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a115"></a><span class="src-sym">}</span></li>
<li><a name="a116"></a>&nbsp;</li>
<li><a name="a117"></a><span class="src-comm">/* Return the article versions info</span></li>
<li><a name="a118"></a><span class="src-comm"> * @param int articleID, string info</span></li>
<li><a name="a119"></a><span class="src-comm"> */</span></li>
<li><a name="a120"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_version_info">getArticle_version_info</a> <span class="src-sym">( </span><span class="src-var">$articleID </span>= <span class="src-num">0 </span><span class="src-sym">, </span><span class="src-var">$info </span>= <span class="src-str">'' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a121"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_versions av &quot;</span><span class="src-sym">;</span></li>
<li><a name="a122"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where av.articleID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">(</span><span class="src-var">$articleID</span><span class="src-sym">)</span><span class="src-sym">; </span></li>
<li><a name="a123"></a>    </li>
<li><a name="a124"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a125"></a>&nbsp;</li>
<li><a name="a126"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a127"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a128"></a>    <span class="src-sym">}</span></li>
<li><a name="a129"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$article_version </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a130"></a>    <span class="src-key">return </span><span class="src-var">$article_version</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a131"></a><span class="src-sym">}</span></li>
<li><a name="a132"></a>&nbsp;</li>
<li><a name="a133"></a><span class="src-comm">/* Return the title of the article</span></li>
<li><a name="a134"></a><span class="src-comm"> * @param int articleID</span></li>
<li><a name="a135"></a><span class="src-comm"> */</span></li>
<li><a name="a136"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticleTitle">getArticleTitle</a><span class="src-sym">(  </span><span class="src-var">$articleID </span>= <span class="src-num">0 </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a137"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot;select * from articles a &quot;</span><span class="src-sym">;</span></li>
<li><a name="a138"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where a.articleID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">(</span><span class="src-var">$articleID</span><span class="src-sym">)</span><span class="src-sym">; </span></li>
<li><a name="a139"></a>    </li>
<li><a name="a140"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a141"></a>&nbsp;</li>
<li><a name="a142"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a143"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a144"></a>    <span class="src-sym">}</span></li>
<li><a name="a145"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$article </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a146"></a>    <span class="src-key">return </span><span class="src-var">$article</span><span class="src-sym">-&gt;</span><span class="src-id">title</span><span class="src-sym">;</span></li>
<li><a name="a147"></a><span class="src-sym">}</span></li>
<li><a name="a148"></a>&nbsp;</li>
<li><a name="a149"></a><span class="src-comm">/* </span></li>
<li><a name="a150"></a><span class="src-comm"> * Return the set of images of this article</span></li>
<li><a name="a151"></a><span class="src-comm"> * return array()</span></li>
<li><a name="a152"></a><span class="src-comm"> */</span></li>
<li><a name="a153"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_imageSets">getArticle_imageSets</a> <span class="src-sym">( </span><span class="src-var">$articleID </span>= <span class="src-num">0 </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a154"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_imgs ai, &quot;</span><span class="src-sym">;</span></li>
<li><a name="a155"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; stockphotos s &quot;</span><span class="src-sym">;</span></li>
<li><a name="a156"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where s.imageID = ai.imageID&quot; </span><span class="src-sym">;</span></li>
<li><a name="a157"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and ai.articleID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$articleID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a158"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and ai.show_image = '1'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a159"></a>    </li>
<li><a name="a160"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a161"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a162"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a163"></a>    <span class="src-sym">}</span></li>
<li><a name="a164"></a>    <span class="src-var">$article_imgs </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a165"></a>    <span class="src-key">while </span><span class="src-sym">(</span><span class="src-var">$article_imgs</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a166"></a>    <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">freeresult</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a167"></a>    <span class="src-comm">//echo 'hi ';</span></li>
<li><a name="a168"></a>    <span class="src-comm">//if ($article_imgs[] = $db-&gt;fetcharray());</span></li>
<li><a name="a169"></a>    <span class="src-key">return </span><span class="src-var">$article_imgs</span><span class="src-sym">;</span></li>
<li><a name="a170"></a><span class="src-sym">}</span></li>
<li><a name="a171"></a>&nbsp;</li>
<li><a name="a172"></a><span class="src-comm">/* Return the author/writer's fullname of the given article</span></li>
<li><a name="a173"></a><span class="src-comm"> * @Deprecated..DO NOT USE! This function is f**ng useless..-{mh}</span></li>
<li><a name="a174"></a><span class="src-comm"> */</span></li>
<li><a name="a175"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_authors">getArticle_authors</a> <span class="src-sym">( </span><span class="src-var">$articleID </span>= <span class="src-num">0 </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a176"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_author aa &quot;</span><span class="src-sym">;</span></li>
<li><a name="a177"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; , content_users cu &quot;</span><span class="src-sym">;</span></li>
<li><a name="a178"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where aa.articleID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$articleID </span><span class="src-sym">) </span><span class="src-sym">;</span></li>
<li><a name="a179"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and aa.userID = cu.userID &quot;</span><span class="src-sym">;</span></li>
<li><a name="a180"></a>    </li>
<li><a name="a181"></a>    <span class="src-comm">//print $sql ;</span></li>
<li><a name="a182"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a183"></a>&nbsp;</li>
<li><a name="a184"></a>&nbsp;</li>
<li><a name="a185"></a>&nbsp;</li>
<li><a name="a186"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a187"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a188"></a>    <span class="src-sym">}</span></li>
<li><a name="a189"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$author </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a190"></a>    <span class="src-key">return </span><span class="src-var">$author</span><span class="src-sym">-&gt;</span><span class="src-id">fullname</span><span class="src-sym">;</span></li>
<li><a name="a191"></a><span class="src-sym">}</span></li>
<li><a name="a192"></a>&nbsp;</li>
<li><a name="a193"></a><span class="src-comm">/* Return the author/writer's info of the article</span></li>
<li><a name="a194"></a><span class="src-comm"> *    @param articleID, info</span></li>
<li><a name="a195"></a><span class="src-comm"> */</span></li>
<li><a name="a196"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_authors_info">getArticle_authors_info</a> <span class="src-sym">( </span><span class="src-var">$articleID </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$info </span>= <span class="src-str">'' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a197"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_author aa &quot;</span><span class="src-sym">;</span></li>
<li><a name="a198"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; , content_users cu &quot;</span><span class="src-sym">;</span></li>
<li><a name="a199"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where aa.articleID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$articleID </span><span class="src-sym">) </span><span class="src-sym">;</span></li>
<li><a name="a200"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and aa.userID = cu.userID &quot;</span><span class="src-sym">;</span></li>
<li><a name="a201"></a>    </li>
<li><a name="a202"></a>    <span class="src-comm">//print $sql ;</span></li>
<li><a name="a203"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a204"></a>&nbsp;</li>
<li><a name="a205"></a>&nbsp;</li>
<li><a name="a206"></a>&nbsp;</li>
<li><a name="a207"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a208"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a209"></a>    <span class="src-sym">}</span></li>
<li><a name="a210"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$author </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a211"></a>    <span class="src-key">return </span><span class="src-var">$author</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a212"></a><span class="src-sym">}</span></li>
<li><a name="a213"></a><span class="src-comm">/* Return the keywords of the article</span></li>
<li><a name="a214"></a><span class="src-comm"> *    @param articleID</span></li>
<li><a name="a215"></a><span class="src-comm"> */</span></li>
<li><a name="a216"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetArticle_keywords">getArticle_keywords</a><span class="src-sym">( </span><span class="src-var">$articleID </span>= <span class="src-num">0 </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a217"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_keywords ak &quot;</span><span class="src-sym">;</span></li>
<li><a name="a218"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where ak.articleID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$articleID </span><span class="src-sym">) </span><span class="src-sym">;</span></li>
<li><a name="a219"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a220"></a>&nbsp;</li>
<li><a name="a221"></a>&nbsp;</li>
<li><a name="a222"></a>&nbsp;</li>
<li><a name="a223"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a224"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a225"></a>    <span class="src-sym">}</span></li>
<li><a name="a226"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$keywords </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a227"></a>    <span class="src-key">return </span><span class="src-var">$keywords</span><span class="src-sym">-&gt;</span><span class="src-id">keywords</span><span class="src-sym">;</span></li>
<li><a name="a228"></a><span class="src-sym">}</span></li>
<li><a name="a229"></a><span class="src-comm">/* Return the user's fullname</span></li>
<li><a name="a230"></a><span class="src-comm"> * @param int userID</span></li>
<li><a name="a231"></a><span class="src-comm"> * Deprecated.. DO NOT USE! use the getUser_info</span></li>
<li><a name="a232"></a><span class="src-comm"> */</span></li>
<li><a name="a233"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetUser_fullname">getUser_fullname</a><span class="src-sym">( </span><span class="src-var">$userID </span>= <span class="src-num">0 </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a234"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot;select * from content_users cu &quot;</span><span class="src-sym">;</span></li>
<li><a name="a235"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where cu.userID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$userID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a236"></a>    </li>
<li><a name="a237"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a238"></a>&nbsp;</li>
<li><a name="a239"></a>&nbsp;</li>
<li><a name="a240"></a>&nbsp;</li>
<li><a name="a241"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a242"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a243"></a>    <span class="src-sym">}</span></li>
<li><a name="a244"></a>    </li>
<li><a name="a245"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$author </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a246"></a>    <span class="src-key">return </span><span class="src-var">$author</span><span class="src-sym">-&gt;</span><span class="src-id">fullname</span><span class="src-sym">;</span></li>
<li><a name="a247"></a><span class="src-sym">}</span></li>
<li><a name="a248"></a>&nbsp;</li>
<li><a name="a249"></a><span class="src-comm">/* Return the user info given the id ... </span></li>
<li><a name="a250"></a><span class="src-comm"> * @param int userID, string info</span></li>
<li><a name="a251"></a><span class="src-comm"> */</span></li>
<li><a name="a252"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetUser_info">getUser_info</a><span class="src-sym">( </span><span class="src-var">$userID </span>= <span class="src-num">0 </span><span class="src-sym">, </span><span class="src-var">$info </span>= <span class="src-str">'' </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a253"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; select * from content_users cu &quot;</span><span class="src-sym">;</span></li>
<li><a name="a254"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where cu.userID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$userID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a255"></a>    </li>
<li><a name="a256"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a257"></a>&nbsp;</li>
<li><a name="a258"></a>&nbsp;</li>
<li><a name="a259"></a>&nbsp;</li>
<li><a name="a260"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a261"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a262"></a>    <span class="src-sym">}</span></li>
<li><a name="a263"></a>    <span class="src-var">$user_info </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a264"></a>    <span class="src-key">return </span><span class="src-var">$user_info</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a265"></a><span class="src-sym">}</span></li>
<li><a name="a266"></a>&nbsp;</li>
<li><a name="a267"></a><span class="src-comm">/* </span></li>
<li><a name="a268"></a><span class="src-comm"> * my friendly date :) - mh</span></li>
<li><a name="a269"></a><span class="src-comm"> */</span></li>
<li><a name="a270"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionfriendlyDate">friendlyDate</a> <span class="src-sym">( </span><span class="src-var">$timestamp </span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">// ex. Sun, February 12, 2006, 11:58:31 pm</span></li>
<li><a name="a271"></a>    <span class="src-key">return    </span><a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">'D, F j, Y, g:i:s a'</span><span class="src-sym">, </span><span class="src-var">$timestamp </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a272"></a><span class="src-sym">}</span></li>
<li><a name="a273"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionfriendlyDate2">friendlyDate2</a> <span class="src-sym">( </span><span class="src-var">$timestamp </span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">// ex. Sun, 2/12/06 11:58:31 pm</span></li>
<li><a name="a274"></a>    <span class="src-key">return    </span><a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">'D, n/j/y g:i:s a'</span><span class="src-sym">, </span><span class="src-var">$timestamp </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a275"></a><span class="src-sym">}</span></li>
<li><a name="a276"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionfriendlyDate3">friendlyDate3</a> <span class="src-sym">( </span><span class="src-var">$timestamp </span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">// ex. Sun, 2/12/06 11:58:31 pm</span></li>
<li><a name="a277"></a>    <span class="src-key">return    </span><a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">'D, n/j/y '</span><span class="src-sym">, </span><span class="src-var">$timestamp </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a278"></a><span class="src-sym">}</span></li>
<li><a name="a279"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionfriendlyDate4">friendlyDate4</a> <span class="src-sym">( </span><span class="src-var">$timestamp </span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">// ex. Sun, Feb 12, 2006, 11:58:31 pm</span></li>
<li><a name="a280"></a>    <span class="src-key">return    </span><a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">'D, M j, Y, g:i:s a'</span><span class="src-sym">, </span><span class="src-var">$timestamp </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a281"></a><span class="src-sym">}</span></li>
<li><a name="a282"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionfriendlyDate5">friendlyDate5</a> <span class="src-sym">( </span><span class="src-var">$timestamp </span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">// ex. Sun, Feb 12, 2006, 11:58:31 pm</span></li>
<li><a name="a283"></a>    <span class="src-key">return    </span><a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">'D, F j, Y, g:i a'</span><span class="src-sym">, </span><span class="src-var">$timestamp </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a284"></a><span class="src-sym">}</span></li>
<li><a name="a285"></a>&nbsp;</li>
<li><a name="a286"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionniceDate">niceDate</a> <span class="src-sym">( </span><span class="src-var">$timestamp </span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">// e. Fri, February 24, 2006 </span></li>
<li><a name="a287"></a>    <span class="src-key">return    </span><a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">'D, F j, Y '</span><span class="src-sym">, </span><span class="src-var">$timestamp </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a288"></a><span class="src-sym">}</span></li>
<li><a name="a289"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionsimpleDate">simpleDate</a><span class="src-sym">( </span><span class="src-var">$unixtimestamp </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a290"></a>    <span class="src-key">return </span><a href="http://www.php.net/date">date</a><span class="src-sym">(</span><span class="src-str">&quot;M-d-Y&quot;</span><span class="src-sym">,</span><span class="src-var">$unixtimestamp </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a291"></a><span class="src-sym">}</span></li>
<li><a name="a292"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionniceTime">niceTime</a> <span class="src-sym">( </span><span class="src-var">$timestamp </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a293"></a>    <span class="src-key">return </span><a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">'g:i:s a'</span><span class="src-sym">, </span><span class="src-var">$timestamp </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a294"></a><span class="src-sym">}</span></li>
<li><a name="a295"></a>&nbsp;</li>
<li><a name="a296"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionconvertdate">convertdate</a><span class="src-sym">(</span><span class="src-var">$date</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a297"></a>    list <span class="src-sym">( </span><span class="src-var">$month</span><span class="src-sym">, </span><span class="src-var">$day</span><span class="src-sym">, </span><span class="src-var">$year</span><span class="src-sym">) </span>= <a href="http://www.php.net/split">split</a> <span class="src-sym">(</span><span class="src-str">&quot;-&quot;</span><span class="src-sym">, </span><span class="src-var">$date</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a298"></a>    <span class="src-var">$date_valid </span>= <a href="http://www.php.net/checkdate">checkdate</a><span class="src-sym">(</span><span class="src-var">$month</span><span class="src-sym">, </span><span class="src-var">$day</span><span class="src-sym">, </span><span class="src-var">$year</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a299"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$date_valid</span>==<span class="src-id">false</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a300"></a>        echo <span class="src-str">&quot;checkdate() returned false.&quot;</span><span class="src-sym">;</span></li>
<li><a name="a301"></a>    <span class="src-sym">}</span></li>
<li><a name="a302"></a>    <span class="src-key">if </span><span class="src-sym">((</span><span class="src-var">$timestamp </span>= <a href="http://www.php.net/strtotime">strtotime</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-var">$month</span>/<span class="src-var">$day</span>/<span class="src-var">$year</span></span><span class="src-str">&quot;</span><span class="src-sym">)) </span>=== -<span class="src-num">1</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a303"></a>        echo <span class="src-str">&quot;Invalid date format.&quot;</span><span class="src-sym">;</span></li>
<li><a name="a304"></a>    <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a305"></a>       <span class="src-key">return </span><span class="src-var">$timestamp</span><span class="src-sym">;</span></li>
<li><a name="a306"></a>    <span class="src-sym">}</span></li>
<li><a name="a307"></a><span class="src-sym">}</span></li>
<li><a name="a308"></a>&nbsp;</li>
<li><a name="a309"></a><span class="src-comm">// Convert the date to string</span></li>
<li><a name="a310"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionstrDate">strDate</a><span class="src-sym">( </span><span class="src-var">$month</span>=<span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$day</span>=<span class="src-str">&quot;&quot; </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a311"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$day</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a312"></a>    <span class="src-key">switch</span><span class="src-sym">(</span><span class="src-var">$day</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a313"></a>        <span class="src-key">case </span><span class="src-num">1</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;Monday&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a314"></a>        <span class="src-key">case </span><span class="src-num">2</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;Tuesday&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a315"></a>        <span class="src-key">case </span><span class="src-num">3</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;Wednesday&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a316"></a>        <span class="src-key">case </span><span class="src-num">4</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;Thursday&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a317"></a>        <span class="src-key">case </span><span class="src-num">5</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;Friday&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a318"></a>        <span class="src-key">case </span><span class="src-num">6</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;Saturday&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a319"></a>        <span class="src-key">case </span><span class="src-num">7</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;Sunday&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a320"></a>    <span class="src-sym">}</span></li>
<li><a name="a321"></a><span class="src-sym">}</span></li>
<li><a name="a322"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$month</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a323"></a>    <span class="src-key">switch</span><span class="src-sym">(</span><span class="src-var">$month</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a324"></a>        <span class="src-key">case </span><span class="src-num">1</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;January&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a325"></a>        <span class="src-key">case </span><span class="src-num">2</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;February&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a326"></a>        <span class="src-key">case </span><span class="src-num">3</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;March&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a327"></a>        <span class="src-key">case </span><span class="src-num">4</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;April&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a328"></a>        <span class="src-key">case </span><span class="src-num">5</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;May&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a329"></a>        <span class="src-key">case </span><span class="src-num">6</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;June&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a330"></a>        <span class="src-key">case </span><span class="src-num">7</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;July&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a331"></a>        <span class="src-key">case </span><span class="src-num">8</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;August&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a332"></a>        <span class="src-key">case </span><span class="src-num">9</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;September&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a333"></a>        <span class="src-key">case </span><span class="src-num">10</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;October&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a334"></a>        <span class="src-key">case </span><span class="src-num">11</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;November&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a335"></a>        <span class="src-key">case </span><span class="src-num">12</span>: <span class="src-var">$date </span>= <span class="src-str">&quot;December&quot;</span><span class="src-sym">; </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a336"></a>        <span class="src-sym">}</span></li>
<li><a name="a337"></a><span class="src-sym">}</span></li>
<li><a name="a338"></a><span class="src-key">return </span><span class="src-var">$date</span><span class="src-sym">;</span></li>
<li><a name="a339"></a><span class="src-sym">}</span></li>
<li><a name="a340"></a>&nbsp;</li>
<li><a name="a341"></a><span class="src-comm">/* Return the group name of this user</span></li>
<li><a name="a342"></a><span class="src-comm"> * @param int userID</span></li>
<li><a name="a343"></a><span class="src-comm"> */</span></li>
<li><a name="a344"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetGroup_name">getGroup_name</a><span class="src-sym">( </span><span class="src-var">$groupid </span>= <span class="src-num">0 </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a345"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; select * from content_usertypes cu &quot;</span><span class="src-sym">;</span></li>
<li><a name="a346"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where cu.usertypeID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$groupid </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a347"></a>    </li>
<li><a name="a348"></a>    <span class="src-comm">//print 'g = '.$sql;</span></li>
<li><a name="a349"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a350"></a>&nbsp;</li>
<li><a name="a351"></a>&nbsp;</li>
<li><a name="a352"></a>&nbsp;</li>
<li><a name="a353"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a354"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a355"></a>    <span class="src-sym">}</span></li>
<li><a name="a356"></a>    <span class="src-var">$group_name </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a357"></a>    <span class="src-key">return </span><span class="src-var">$group_name</span><span class="src-sym">-&gt;</span><span class="src-id">usertype_name</span><span class="src-sym">;</span></li>
<li><a name="a358"></a><span class="src-sym">}</span></li>
<li><a name="a359"></a>&nbsp;</li>
<li><a name="a360"></a><span class="src-comm">/* Log the user</span></li>
<li><a name="a361"></a><span class="src-comm"> *</span></li>
<li><a name="a362"></a><span class="src-comm"> */</span></li>
<li><a name="a363"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionuser_log">user_log</a> <span class="src-sym">( </span><span class="src-var">$userID </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a364"></a>    <span class="src-var">$day </span>= <a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">&quot;d l&quot; </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a365"></a>    <span class="src-var">$month </span>= <a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">&quot;F&quot; </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a366"></a>    <span class="src-var">$year </span>= <a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">&quot;Y&quot; </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a367"></a>    <span class="src-var">$hour </span>= <a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">&quot;h&quot; </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a368"></a>    <span class="src-var">$minute </span>= <a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">&quot;i&quot; </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a369"></a>    <span class="src-var">$second </span>= <a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">&quot;s&quot; </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a370"></a>    <span class="src-var">$am_pm </span>= <a href="http://www.php.net/date">date</a><span class="src-sym">( </span><span class="src-str">&quot;a&quot; </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a371"></a>    </li>
<li><a name="a372"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; insert into user_log ( userID, log_day, log_month, log_year, log_hour, log_minute, log_second, log_am_pm ) &quot;</span><span class="src-sym">;</span></li>
<li><a name="a373"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">values</span>( '<span class="src-var">$userID</span>' , '<span class="src-var">$day</span>' , '<span class="src-var">$month</span>' , '<span class="src-var">$year</span>' , '<span class="src-var">$hour</span>' , '<span class="src-var">$minute</span>' , '<span class="src-var">$second</span>' , '<span class="src-var">$am_pm</span>' )</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a374"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a375"></a>&nbsp;</li>
<li><a name="a376"></a>&nbsp;</li>
<li><a name="a377"></a>&nbsp;</li>
<li><a name="a378"></a>    </li>
<li><a name="a379"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a380"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a381"></a>    <span class="src-sym">}</span></li>
<li><a name="a382"></a>    <span class="src-key">else</span><span class="src-sym">{</span></li>
<li><a name="a383"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'User log failed..'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a384"></a>    <span class="src-sym">}</span></li>
<li><a name="a385"></a><span class="src-sym">}</span></li>
<li><a name="a386"></a>&nbsp;</li>
<li><a name="a387"></a><span class="src-comm">/* Return the frontpage type of the article</span></li>
<li><a name="a388"></a><span class="src-comm"> * @param int articleID</span></li>
<li><a name="a389"></a><span class="src-comm"> */</span></li>
<li><a name="a390"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetFrontpage_type">getFrontpage_type</a><span class="src-sym">( </span><span class="src-var">$articleID </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a391"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_frontpage af , &quot;</span><span class="src-sym">;</span></li>
<li><a name="a392"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; frontpage_sections fs &quot;</span><span class="src-sym">;</span></li>
<li><a name="a393"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where af.articleID =&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$articleID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a394"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and af.frontpage_sectionID = fs.frontpage_sectionID&quot;</span><span class="src-sym">;</span></li>
<li><a name="a395"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a396"></a>&nbsp;</li>
<li><a name="a397"></a>&nbsp;</li>
<li><a name="a398"></a>&nbsp;</li>
<li><a name="a399"></a>    </li>
<li><a name="a400"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a401"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a402"></a>    <span class="src-sym">}</span></li>
<li><a name="a403"></a>    <span class="src-var">$frontpage </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a404"></a>    <span class="src-key">return </span><span class="src-var">$frontpage</span><span class="src-sym">-&gt;</span><span class="src-id">frontpage_section</span><span class="src-sym">;</span></li>
<li><a name="a405"></a><span class="src-sym">}</span></li>
<li><a name="a406"></a>&nbsp;</li>
<li><a name="a407"></a><span class="src-comm">/* Return the stage name of this stageid</span></li>
<li><a name="a408"></a><span class="src-comm"> * @param int stageID</span></li>
<li><a name="a409"></a><span class="src-comm"> */</span></li>
<li><a name="a410"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetStage_name">getStage_name</a> <span class="src-sym">( </span><span class="src-var">$stageID </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a411"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from stages s &quot;</span><span class="src-sym">;            </span></li>
<li><a name="a412"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where s.stageID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$stageID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a413"></a>    </li>
<li><a name="a414"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a415"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a416"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a417"></a>    <span class="src-sym">}</span></li>
<li><a name="a418"></a>    <span class="src-var">$stagename </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a419"></a>    <span class="src-key">return </span><span class="src-var">$stagename</span><span class="src-sym">-&gt;</span><span class="src-id">stage</span><span class="src-sym">;</span></li>
<li><a name="a420"></a><span class="src-sym">}</span></li>
<li><a name="a421"></a><span class="src-doc">/**</span></li>
<li><a name="a422"></a><span class="src-doc"> * check if &quot;http://&quot; strings was found..</span></li>
<li><a name="a423"></a><span class="src-doc"> */ </span></li>
<li><a name="a424"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functioncheckhttptext">checkhttptext</a><span class="src-sym">( </span><span class="src-var">$url </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a425"></a>    <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;/^http:\/\//&quot;</span><span class="src-sym">, </span><span class="src-var">$url </span><span class="src-sym">)) </span><span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a426"></a>    <span class="src-key">else </span><span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a427"></a><span class="src-sym">}</span></li>
<li><a name="a428"></a><span class="src-doc">/**</span></li>
<li><a name="a429"></a><span class="src-doc"> * remove &quot;http://&quot; strings</span></li>
<li><a name="a430"></a><span class="src-doc"> */ </span></li>
<li><a name="a431"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionsplithttptext">splithttptext</a><span class="src-sym">( </span><span class="src-var">$url </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a432"></a>    <span class="src-var">$url </span>= <a href="http://www.php.net/preg_split">preg_split</a><span class="src-sym">( </span><span class="src-str">&quot;/^http:\/\//&quot;</span><span class="src-sym">, </span><span class="src-var">$url </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a433"></a>    <span class="src-key">return </span><span class="src-var">$url</span><span class="src-sym">;</span></li>
<li><a name="a434"></a><span class="src-sym">}</span></li>
<li><a name="a435"></a><span class="src-doc">/**</span></li>
<li><a name="a436"></a><span class="src-doc"> * Convert the path into a desired relative path</span></li>
<li><a name="a437"></a><span class="src-doc"> */ </span></li>
<li><a name="a438"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionmakeRelativePath">makeRelativePath</a><span class="src-sym">( </span><span class="src-var">$path</span><span class="src-sym">, </span><span class="src-var">$offset </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a439"></a>    <span class="src-key">if </span><span class="src-sym">( </span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;[../]&quot;</span><span class="src-sym">, </span><span class="src-var">$path </span><span class="src-sym">) ) </span><span class="src-sym">{</span></li>
<li><a name="a440"></a>        <span class="src-var">$newpath </span>= <a href="http://www.php.net/split">split</a><span class="src-sym">(</span><span class="src-str">&quot;[../]&quot;</span><span class="src-sym">, </span><span class="src-var">$path</span><span class="src-sym">, </span><span class="src-var">$offset </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a441"></a>        <span class="src-key">return </span><span class="src-var">$newpath</span><span class="src-sym">[</span><span class="src-var">$offset</span>-<span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a442"></a>    <span class="src-sym">}</span></li>
<li><a name="a443"></a>    <span class="src-key">else</span><span class="src-sym">{</span></li>
<li><a name="a444"></a>        <span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a445"></a>    <span class="src-sym">}</span></li>
<li><a name="a446"></a><span class="src-sym">}</span></li>
<li><a name="a447"></a><span class="src-comm">/* Create a short intro based from the article</span></li>
<li><a name="a448"></a><span class="src-comm">* @access public</span></li>
<li><a name="a449"></a><span class="src-comm">* @param string $body</span></li>
<li><a name="a450"></a><span class="src-comm">*/</span></li>
<li><a name="a451"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionmakeAShortIntro">makeAShortIntro</a><span class="src-sym">( </span><span class="src-var">$body </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a452"></a>    <span class="src-var">$sentences     </span>= <a href="http://www.php.net/preg_split">preg_split</a><span class="src-sym">(</span><span class="src-str">&quot;/[\.]/&quot;</span><span class="src-sym">, </span><span class="src-var">$body</span><span class="src-sym">)</span><span class="src-sym">; </span></li>
<li><a name="a453"></a>    <span class="src-var">$n            </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$sentences</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm">// count no. of sentences..</span></li>
<li><a name="a454"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$n</span>&gt;<span class="src-num">4</span><span class="src-sym">)</span><span class="src-sym">{ </span><span class="src-comm">// if the articles contains more than 2 sentences</span></li>
<li><a name="a455"></a>        <span class="src-var">$tmp </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a456"></a>        <span class="src-var">$tmp </span>= <span class="src-var">$sentences</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">] </span>. <span class="src-var">$sentences</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>. <span class="src-var">$sentences</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">; </span><span class="src-comm">// extract the 1st sentences only.</span></li>
<li><a name="a457"></a>        <span class="src-var">$str </span>= <span class="src-var">$tmp </span>. <span class="src-str">'......'</span><span class="src-sym">;</span></li>
<li><a name="a458"></a>        <span class="src-key">return </span><span class="src-var">$str</span><span class="src-sym">;</span></li>
<li><a name="a459"></a>    <span class="src-sym">}</span></li>
<li><a name="a460"></a>    <span class="src-key">else</span><span class="src-sym">{</span></li>
<li><a name="a461"></a>        <span class="src-key">return </span><span class="src-var">$body</span><span class="src-sym">;</span></li>
<li><a name="a462"></a>    <span class="src-sym">}</span></li>
<li><a name="a463"></a><span class="src-sym">}</span></li>
<li><a name="a464"></a><span class="src-doc">/**</span></li>
<li><a name="a465"></a><span class="src-doc"> * return the allowable stages that can be set by the content users..{mh}</span></li>
<li><a name="a466"></a><span class="src-doc"> */</span></li>
<li><a name="a467"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionallow_Stage_to_set">allow_Stage_to_set</a> <span class="src-sym">( </span><span class="src-var">$curstageID </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a468"></a>    <span class="src-key">switch </span><span class="src-sym">( </span><span class="src-var">$curstageID </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a469"></a>        <span class="src-comm">// if the current stage of the article is drafting, </span></li>
<li><a name="a470"></a>        <span class="src-comm">// then the article can be set only to writing stage , but not editing stage..</span></li>
<li><a name="a471"></a>        <span class="src-comm">// if done drafting, the writer can set the stage to writing stage (2), </span></li>
<li><a name="a472"></a>        <span class="src-comm">// which means the article has done on the writing stage.</span></li>
<li><a name="a473"></a>        <span class="src-key">case </span><span class="src-num">1</span>: <span class="src-comm">// drafting</span></li>
<li><a name="a474"></a>        <span class="src-key">case </span><span class="src-num">2</span>:</li>
<li><a name="a475"></a>            <span class="src-var">$nextstageID </span>= <span class="src-num">2</span><span class="src-sym">; </span><span class="src-comm">// writing stage  </span></li>
<li><a name="a476"></a>            <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a477"></a>        <span class="src-key">case </span><span class="src-num">3</span>: </li>
<li><a name="a478"></a>        <span class="src-comm">// the editors will see only the articles that was passed on the writing stage.</span></li>
<li><a name="a479"></a>        <span class="src-comm">// likewise, the editors can set only to editing stage( pass to newsdirector )</span></li>
<li><a name="a480"></a>            <span class="src-var">$nextstageID </span>= <span class="src-var">$curstageID </span>- <span class="src-num">1 </span><span class="src-sym">; </span><span class="src-comm">// editing stage..          </span></li>
<li><a name="a481"></a>            <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a482"></a>        <span class="src-key">case </span><span class="src-num">4</span>: </li>
<li><a name="a483"></a>        <span class="src-comm">// the newsdirector will see only the articles that was passed on the editing stage..</span></li>
<li><a name="a484"></a>        <span class="src-comm">// if the article is on the editing stage, </span></li>
<li><a name="a485"></a>        <span class="src-comm">// it can be set only to review stage..go! go! go!      </span></li>
<li><a name="a486"></a>            <span class="src-var">$nextstageID </span>= <span class="src-var">$curstageID </span>- <span class="src-num">1 </span><span class="src-sym">;          </span></li>
<li><a name="a487"></a>            <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a488"></a>        <span class="src-key">case </span><span class="src-num">5</span>: </li>
<li><a name="a489"></a>        <span class="src-comm">// the publisher will see only the articles which already been reviewd by the newsdirector</span></li>
<li><a name="a490"></a>        <span class="src-comm">//and so the article is ready to publish on live site..oh yaahhh, uhmmm...hmm!!..</span></li>
<li><a name="a491"></a>            <span class="src-var">$nextstageID </span>= <span class="src-var">$curstageID </span>- <span class="src-num">1 </span><span class="src-sym">;</span></li>
<li><a name="a492"></a>            <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a493"></a>    <span class="src-sym">}</span></li>
<li><a name="a494"></a>    </li>
<li><a name="a495"></a>    <span class="src-comm">/*</span></li>
<li><a name="a496"></a><span class="src-comm">    OBSELETE!!</span></li>
<li><a name="a497"></a><span class="src-comm">    $sql = &quot; select * from stages s &quot;;</span></li>
<li><a name="a498"></a><span class="src-comm">    $sql .= &quot; where s.stageID &lt;= &quot; .intval ( $curstageID );</span></li>
<li><a name="a499"></a><span class="src-comm">    $sql .= &quot; and s.stageID &gt;=&quot; .intval ( $nextstageID ) ;</span></li>
<li><a name="a500"></a>    </li>
<li><a name="a501"></a><span class="src-comm">    print $sql;</span></li>
<li><a name="a502"></a><span class="src-comm">    $db = new database;</span></li>
<li><a name="a503"></a>&nbsp;</li>
<li><a name="a504"></a>&nbsp;</li>
<li><a name="a505"></a>&nbsp;</li>
<li><a name="a506"></a>    </li>
<li><a name="a507"></a><span class="src-comm">    if (!($result = $db-&gt;query( $sql ))) {</span></li>
<li><a name="a508"></a><span class="src-comm">        die('Error:'. $db-&gt;error());</span></li>
<li><a name="a509"></a><span class="src-comm">    }</span></li>
<li><a name="a510"></a>    </li>
<li><a name="a511"></a><span class="src-comm">    $allow_stages = array();</span></li>
<li><a name="a512"></a><span class="src-comm">    while ( $allow_stages[] = $db-&gt;fetcharray() );</span></li>
<li><a name="a513"></a>    </li>
<li><a name="a514"></a><span class="src-comm">    print_r(     $allow_stages );</span></li>
<li><a name="a515"></a><span class="src-comm">    */</span></li>
<li><a name="a516"></a>    <span class="src-key">return </span><span class="src-var">$nextstageID</span><span class="src-sym">;</span></li>
<li><a name="a517"></a><span class="src-sym">}</span></li>
<li><a name="a518"></a><span class="src-doc">/**</span></li>
<li><a name="a519"></a><span class="src-doc"> * Get the basic info of the image</span></li>
<li><a name="a520"></a><span class="src-doc"> */</span></li>
<li><a name="a521"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetImages_info">getImages_info</a><span class="src-sym">( </span><span class="src-var">$filename </span>= <span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$info </span>= <span class="src-str">'' </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a522"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from stockphotos &quot;</span><span class="src-sym">;</span></li>
<li><a name="a523"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">where</span> <span class="src-id">image_filename</span>='<span class="src-var">$filename</span>'</span><span class="src-str">&quot;  </span><span class="src-sym">;</span></li>
<li><a name="a524"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a525"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">( </span><span class="src-var">$sql </span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a526"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a527"></a>    <span class="src-sym">}</span></li>
<li><a name="a528"></a>    <span class="src-var">$imageinfo </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a529"></a>    <span class="src-key">return </span><span class="src-var">$imageinfo</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a530"></a><span class="src-sym">}</span></li>
<li><a name="a531"></a><span class="src-doc">/**</span></li>
<li><a name="a532"></a><span class="src-doc"> * Get live articles on this category</span></li>
<li><a name="a533"></a><span class="src-doc"> */</span></li>
<li><a name="a534"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetLiveArticleOnCategory">getLiveArticleOnCategory</a><span class="src-sym">( </span><span class="src-var">$categoryid </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$day</span><span class="src-sym">, </span><span class="src-var">$month</span><span class="src-sym">, </span><span class="src-var">$year</span><span class="src-sym">,  </span><span class="src-var">$offset </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a535"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_versions av, &quot;</span><span class="src-sym">;</span></li>
<li><a name="a536"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; article_category ac &quot;</span><span class="src-sym">;</span></li>
<li><a name="a537"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; , article_frontpage af &quot;</span><span class="src-sym">;</span></li>
<li><a name="a538"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where av.articleID = ac.articleID &quot;</span><span class="src-sym">;</span></li>
<li><a name="a539"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and af.frontpage_sectionID != 2 &quot;</span><span class="src-sym">;</span></li>
<li><a name="a540"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and af.frontpage_sectionID != 1 &quot;</span><span class="src-sym">;</span></li>
<li><a name="a541"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and af.articleID = av.articleID &quot;</span><span class="src-sym">;</span></li>
<li><a name="a542"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and ac.categoryID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">(</span><span class="src-var">$categoryid</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a543"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and av.stageID = '6' &quot;</span><span class="src-sym">;</span></li>
<li><a name="a544"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and ac.articleID = av.articleID&quot;</span><span class="src-sym">;</span></li>
<li><a name="a545"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">and</span> <span class="src-id">av</span>.<span class="src-id">published_day</span> = '<span class="src-var">$day</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a546"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">and</span> <span class="src-id">av</span>.<span class="src-id">published_month</span> = '<span class="src-var">$month</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a547"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">and</span> <span class="src-id">av</span>.<span class="src-id">published_year</span> = '<span class="src-var">$year</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a548"></a>    <span class="src-comm">//$sql .= &quot; and av.dateline = '$dateline' &quot;;</span></li>
<li><a name="a549"></a>    <span class="src-var">$sql </span>.= <span class="src-sym">( </span><span class="src-var">$offset </span><span class="src-sym">)</span>? <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">order</span> <span class="src-id">by</span> <span class="src-id">av</span>.<span class="src-id">dateline</span> <span class="src-id">desc</span> <span class="src-id">limit</span> <span class="src-var">$offset</span></span><span class="src-str">&quot; </span>: <span class="src-str">&quot;order by av.dateline desc&quot;</span><span class="src-sym">;    </span></li>
<li><a name="a550"></a>    <span class="src-comm">//echo $sql;</span></li>
<li><a name="a551"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a552"></a>&nbsp;</li>
<li><a name="a553"></a>&nbsp;</li>
<li><a name="a554"></a>&nbsp;</li>
<li><a name="a555"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)))</span><span class="src-sym">{</span></li>
<li><a name="a556"></a>            <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:'</span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a557"></a>    <span class="src-sym">}</span></li>
<li><a name="a558"></a>    <span class="src-var">$article_category </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a559"></a>    <span class="src-key">while</span><span class="src-sym">(</span><span class="src-var">$article_category</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a560"></a>    <span class="src-key">return </span><span class="src-var">$article_category</span><span class="src-sym">;</span></li>
<li><a name="a561"></a><span class="src-sym">} </span></li>
<li><a name="a562"></a>&nbsp;</li>
<li><a name="a563"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functioncountArticle_versions_stage">countArticle_versions_stage</a><span class="src-sym">( </span><span class="src-var">$stageid </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a564"></a>    <span class="src-comm">// Get and count the articles on diff stage</span></li>
<li><a name="a565"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from article_versions &quot;</span><span class="src-sym">;</span></li>
<li><a name="a566"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">where</span> <span class="src-id">stageID</span> = <span class="src-var">$stageid</span> </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a567"></a>    <span class="src-comm">//$sql .= &quot; and status = '--' &quot;;</span></li>
<li><a name="a568"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; or status = 'revise' &quot;</span><span class="src-sym">;</span></li>
<li><a name="a569"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a570"></a>&nbsp;</li>
<li><a name="a571"></a>&nbsp;</li>
<li><a name="a572"></a>&nbsp;</li>
<li><a name="a573"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a574"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a575"></a>    <span class="src-sym">}</span></li>
<li><a name="a576"></a>    <span class="src-var">$article </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a577"></a>    <span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$row  </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) ) </span><span class="src-sym">{ </span><span class="src-var">$article</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">; </span><span class="src-sym">}</span></li>
<li><a name="a578"></a>    <span class="src-var">$nitems </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">( </span><span class="src-var">$article </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a579"></a>    <span class="src-key">return </span><span class="src-var">$nitems</span><span class="src-sym">;</span></li>
<li><a name="a580"></a><span class="src-sym">}</span></li>
<li><a name="a581"></a><span class="src-doc">/**</span></li>
<li><a name="a582"></a><span class="src-doc"> * Check the user access rights</span></li>
<li><a name="a583"></a><span class="src-doc"> */</span></li>
<li><a name="a584"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functioncheckUserAccessRights">checkUserAccessRights</a><span class="src-sym">( </span><span class="src-var">$userID </span><span class="src-sym">, </span><span class="src-var">$stage </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a585"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot;select * from user_stage &quot;</span><span class="src-sym">;</span></li>
<li><a name="a586"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; where userID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$userID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a587"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and stageID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$stage </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a588"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a589"></a>    <span class="src-comm">// echo $sql;</span></li>
<li><a name="a590"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a591"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a592"></a>    <span class="src-sym">}</span></li>
<li><a name="a593"></a>    <span class="src-var">$rights </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a594"></a>    <span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$row  </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) ) </span><span class="src-sym">{ </span><span class="src-var">$rights</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">; </span><span class="src-sym">}    </span></li>
<li><a name="a595"></a>    <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">getnumrows</span><span class="src-sym">(</span><span class="src-sym">) </span>&gt; <span class="src-num">0 </span><span class="src-sym">) </span><span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a596"></a>    <span class="src-key">else </span><span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a597"></a><span class="src-sym">}</span></li>
<li><a name="a598"></a><span class="src-doc">/**</span></li>
<li><a name="a599"></a><span class="src-doc"> * Check the revision lists of the article on this stage</span></li>
<li><a name="a600"></a><span class="src-doc"> */</span></li>
<li><a name="a601"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functioncheckRevisionLists">checkRevisionLists</a><span class="src-sym">( </span><span class="src-var">$articleID</span><span class="src-sym">, </span><span class="src-var">$stage </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a602"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot;select * from articles av &quot;</span><span class="src-sym">;</span></li>
<li><a name="a603"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;where av.articleID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$articleID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a604"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and av.status='revise' &quot;</span><span class="src-sym">;</span></li>
<li><a name="a605"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and av.stageID=&quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$stage </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a606"></a>    <span class="src-comm">//$sql .= &quot; and av.stageID= -1&quot; ;</span></li>
<li><a name="a607"></a>    </li>
<li><a name="a608"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a609"></a>&nbsp;</li>
<li><a name="a610"></a>&nbsp;</li>
<li><a name="a611"></a>&nbsp;</li>
<li><a name="a612"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a613"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a614"></a>    <span class="src-sym">}</span></li>
<li><a name="a615"></a>    <span class="src-var">$revlist </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a616"></a>    <span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$row  </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) ) </span><span class="src-sym">{ </span><span class="src-var">$revlist</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">; </span><span class="src-sym">}    </span></li>
<li><a name="a617"></a>    <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">getnumrows</span><span class="src-sym">(</span><span class="src-sym">) </span>&gt; <span class="src-num">0 </span><span class="src-sym">) </span><span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a618"></a>    <span class="src-key">else </span><span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a619"></a><span class="src-sym">}</span></li>
<li><a name="a620"></a><span class="src-doc">/**</span></li>
<li><a name="a621"></a><span class="src-doc"> * Get the client active banners</span></li>
<li><a name="a622"></a><span class="src-doc"> */</span></li>
<li><a name="a623"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetClientActiveBanners">getClientActiveBanners</a><span class="src-sym">( </span><span class="src-var">$clientID </span>= <span class="src-num">0 </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a624"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot;select * from corporate_partners_imgs cpimgs &quot;</span><span class="src-sym">;</span></li>
<li><a name="a625"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;where cpimgs.banner_clientID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$clientID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a626"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and cpimgs.banner_show = '1' &quot;</span><span class="src-sym">;</span></li>
<li><a name="a627"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a628"></a>&nbsp;</li>
<li><a name="a629"></a>&nbsp;</li>
<li><a name="a630"></a>&nbsp;</li>
<li><a name="a631"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a632"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a633"></a>    <span class="src-sym">}</span></li>
<li><a name="a634"></a>    <span class="src-var">$active_banners </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a635"></a>    <span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$active_banners</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a636"></a>    <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">freeresult</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a637"></a>    <span class="src-key">return </span><span class="src-var">$active_banners</span><span class="src-sym">;</span></li>
<li><a name="a638"></a><span class="src-sym">}</span></li>
<li><a name="a639"></a><span class="src-doc">/**</span></li>
<li><a name="a640"></a><span class="src-doc"> * Get the client active banners info</span></li>
<li><a name="a641"></a><span class="src-doc"> */</span></li>
<li><a name="a642"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetBannerclient_info">getBannerclient_info</a><span class="src-sym">( </span><span class="src-var">$clientID </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$info </span>= <span class="src-str">&quot;&quot; </span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a643"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from corporate_partners_imgs cpimgs, corporate_partners cp &quot;</span><span class="src-sym">;</span></li>
<li><a name="a644"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;where cp.clientID = &quot; </span>. <a href="http://www.php.net/intval">intval</a><span class="src-sym">( </span><span class="src-var">$clientID </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a645"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot; and cpimgs.banner_clientID = cp.clientID &quot;</span><span class="src-sym">;</span></li>
<li><a name="a646"></a>    <span class="src-comm">//echo $sql;</span></li>
<li><a name="a647"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a648"></a>&nbsp;</li>
<li><a name="a649"></a>&nbsp;</li>
<li><a name="a650"></a>&nbsp;</li>
<li><a name="a651"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a652"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a653"></a>    <span class="src-sym">}</span></li>
<li><a name="a654"></a>    <span class="src-var">$bannerinfo </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a655"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$bannerinfo </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a656"></a>    <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">freeresult</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a657"></a>    <span class="src-key">return </span><span class="src-var">$bannerinfo</span><span class="src-sym">-&gt;</span><span class="src-var">$info</span><span class="src-sym">;</span></li>
<li><a name="a658"></a><span class="src-sym">}</span></li>
<li><a name="a659"></a><span class="src-doc">/**</span></li>
<li><a name="a660"></a><span class="src-doc"> * Send email</span></li>
<li><a name="a661"></a><span class="src-doc"> */</span></li>
<li><a name="a662"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functionsendmail">sendmail</a><span class="src-sym">( </span><span class="src-var">$to</span><span class="src-sym">, </span><span class="src-var">$subject</span><span class="src-sym">, </span><span class="src-var">$msg </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a663"></a>    <a href="http://www.php.net/mail">mail</a><span class="src-sym">( </span><span class="src-var">$to</span><span class="src-sym">, </span><span class="src-var">$subject</span><span class="src-sym">, </span><span class="src-var">$msg </span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a664"></a><span class="src-sym">}</span></li>
<li><a name="a665"></a><span class="src-doc">/**</span></li>
<li><a name="a666"></a><span class="src-doc"> * Get the current workload of the user</span></li>
<li><a name="a667"></a><span class="src-doc"> */</span></li>
<li><a name="a668"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetUserWorkload">getUserWorkload</a><span class="src-sym">( </span><span class="src-var">$userID</span><span class="src-sym">, </span><span class="src-var">$currenttime </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a669"></a>    <span class="src-var">$currenttime </span>= <a href="../brwcms/_code_corefunctions_php.html#functionsimpleDate">simpleDate</a><span class="src-sym">(</span><span class="src-var">$currenttime</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a670"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from tasks &quot;</span><span class="src-sym">;</span></li>
<li><a name="a671"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">where</span> <span class="src-id">assignedto</span> = '<span class="src-var">$userID</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a672"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">and</span> <span class="src-id">created</span> = '<span class="src-var">$currenttime</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a673"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a674"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a675"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a676"></a>    <span class="src-sym">}</span></li>
<li><a name="a677"></a>    <span class="src-var">$workloads </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a678"></a>    <span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$row </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-var">$workloads</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">; </span></li>
<li><a name="a679"></a>    <span class="src-key">return </span><span class="src-var">$workloads</span><span class="src-sym">;</span></li>
<li><a name="a680"></a><span class="src-sym">}</span></li>
<li><a name="a681"></a>&nbsp;</li>
<li><a name="a682"></a><span class="src-doc">/**</span></li>
<li><a name="a683"></a><span class="src-doc"> * Return the status of the writer task.</span></li>
<li><a name="a684"></a><span class="src-doc"> */</span></li>
<li><a name="a685"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetWriterTaskStatus">getWriterTaskStatus</a><span class="src-sym">( </span><span class="src-var">$userID</span><span class="src-sym">, </span><span class="src-var">$status</span><span class="src-sym">, </span><span class="src-var">$currenttime </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a686"></a>    <span class="src-var">$currenttime </span>= <a href="../brwcms/_code_corefunctions_php.html#functionsimpleDate">simpleDate</a><span class="src-sym">(</span><span class="src-var">$currenttime</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a687"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">select</span> * <span class="src-id">from</span> <span class="src-id">tasks</span> <span class="src-id">where</span> <span class="src-id">assignedto</span> = '<span class="src-var">$userID</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a688"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">and</span> <span class="src-id">status</span> = '<span class="src-var">$status</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a689"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">and</span> <span class="src-id">created</span> = '<span class="src-var">$currenttime</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a690"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a691"></a>&nbsp;</li>
<li><a name="a692"></a>&nbsp;</li>
<li><a name="a693"></a>&nbsp;</li>
<li><a name="a694"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a695"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a696"></a>    <span class="src-sym">}</span></li>
<li><a name="a697"></a>    <span class="src-var">$workloads </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a698"></a>    <span class="src-key">while</span><span class="src-sym">( </span><span class="src-var">$row </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-var">$workloads</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$row</span><span class="src-sym">; </span></li>
<li><a name="a699"></a>    <span class="src-key">return </span><span class="src-var">$workloads</span><span class="src-sym">;  </span></li>
<li><a name="a700"></a><span class="src-sym">}</span></li>
<li><a name="a701"></a><span class="src-doc">/**</span></li>
<li><a name="a702"></a><span class="src-doc"> * Check if the writer is available to give a task.</span></li>
<li><a name="a703"></a><span class="src-doc"> */</span></li>
<li><a name="a704"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functioncheckIfWriterIsAvailableToAssignedTheTask">checkIfWriterIsAvailableToAssignedTheTask</a><span class="src-sym">( </span><span class="src-var">$userID</span><span class="src-sym">, </span><span class="src-var">$currenttime</span><span class="src-sym">, </span><span class="src-var">$numtaskrequired </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a705"></a>    <span class="src-var">$currenttime </span>= <a href="../brwcms/_code_corefunctions_php.html#functionsimpleDate">simpleDate</a><span class="src-sym">(</span><span class="src-var">$currenttime</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a706"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot; select * from tasks &quot;</span><span class="src-sym">;</span></li>
<li><a name="a707"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">where</span> <span class="src-id">assignedto</span> = '<span class="src-var">$userID</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a708"></a>    <span class="src-var">$sql </span>.= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">and</span> <span class="src-id">created</span> = '<span class="src-var">$currenttime</span>' </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a709"></a>    <span class="src-comm">//echo $sql;</span></li>
<li><a name="a710"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a711"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a712"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a713"></a>    <span class="src-sym">}</span></li>
<li><a name="a714"></a>    <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">getnumrows</span><span class="src-sym">(</span><span class="src-sym">) </span>&lt; <span class="src-var">$numtaskrequired</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a715"></a>        <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span><span class="src-comm">// this writer is available to assign the task</span></li>
<li><a name="a716"></a>    <span class="src-sym">}</span></li>
<li><a name="a717"></a>    <span class="src-key">else</span><span class="src-sym">{</span></li>
<li><a name="a718"></a>        <span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span><span class="src-comm">// this writer is not available to give a task</span></li>
<li><a name="a719"></a>    <span class="src-sym">}</span></li>
<li><a name="a720"></a><span class="src-sym">}</span></li>
<li><a name="a721"></a><span class="src-doc">/**</span></li>
<li><a name="a722"></a><span class="src-doc"> * Get current active quota</span></li>
<li><a name="a723"></a><span class="src-doc"> */</span></li>
<li><a name="a724"></a><span class="src-key">function </span><a href="../brwcms/_code_corefunctions_php.html#functiongetActiveQuota">getActiveQuota</a><span class="src-sym">( </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a725"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot;select * from quota where isdefault=1 &quot;</span><span class="src-sym">;</span></li>
<li><a name="a726"></a>    <span class="src-var">$db </span>= <span class="src-key">new </span><span class="src-id"><a href="../brwcms/database.html">database</a></span><span class="src-sym">;</span></li>
<li><a name="a727"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">( </span><span class="src-var">$result </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">query</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">))) </span><span class="src-sym">{</span></li>
<li><a name="a728"></a>        <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Error:' </span>. <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">error</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a729"></a>    <span class="src-sym">}</span></li>
<li><a name="a730"></a>    <span class="src-var">$quota </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a731"></a>    <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$quota</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">fetcharray</span><span class="src-sym">(</span><span class="src-sym">) )</span><span class="src-sym">;    </span></li>
<li><a name="a732"></a>    <span class="src-key">return </span><span class="src-var">$quota</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">quota</span><span class="src-sym">;</span></li>
<li><a name="a733"></a><span class="src-sym">}</span></li>
<li><a name="a734"></a><span class="src-php">?&gt;</span></li>
</ol></pre>
</div>
	<p class="notes" id="credit">
		Documentation generated on Wed,  5 Apr 2006 20:09:21 -0700 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.3.0RC4</a>
	</p>
	</body>
</html>